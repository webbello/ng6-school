<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>E-CLASS documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">E-CLASS documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>UserData</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/components/quiz/quiz-detail/quiz-detail.component.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#color">color</a>
                                </li>
                                <li>
                                        <a href="#id">id</a>
                                </li>
                                <li>
                                        <a href="#name">name</a>
                                </li>
                                <li>
                                        <a href="#progress">progress</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="color"></a>
                                        <span class="name"><b>color</b><a href="#color"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>color:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="id"></a>
                                        <span class="name"><b>id</b><a href="#id"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name"><b>name</b><a href="#name"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="progress"></a>
                                        <span class="name"><b>progress</b><a href="#progress"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>progress:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, ViewChild } from &#x27;@angular/core&#x27;;
import { ActivatedRoute, Router } from &#x27;@angular/router&#x27;;
import { QuizService } from &#x27;../../../services/quiz/quiz.service&#x27;;
import { AuthService } from &#x27;../../../services/auth/auth.service&#x27;;
import { User } from &#x27;../../../models/chat/user&#x27;;
import { Chart } from &#x27;chart.js&#x27;;
import { QuizResultModel } from &#x27;../../../models/socket/quiz&#x27;;
import { ChatService } from &#x27;../../../services/chat.service&#x27;;

import {MatPaginator} from &#x27;@angular/material/paginator&#x27;;
import {MatSort} from &#x27;@angular/material/sort&#x27;;
import {MatTableDataSource} from &#x27;@angular/material/table&#x27;;
export interface UserData {
  id: string;
  name: string;
  progress: string;
  color: string;
}

/** Constants used to fill up our data base. */
const COLORS: string[] &#x3D; [
  &#x27;maroon&#x27;, &#x27;red&#x27;, &#x27;orange&#x27;, &#x27;yellow&#x27;, &#x27;olive&#x27;, &#x27;green&#x27;, &#x27;purple&#x27;, &#x27;fuchsia&#x27;, &#x27;lime&#x27;, &#x27;teal&#x27;,
  &#x27;aqua&#x27;, &#x27;blue&#x27;, &#x27;navy&#x27;, &#x27;black&#x27;, &#x27;gray&#x27;
];
const NAMES: string[] &#x3D; [
  &#x27;Maia&#x27;, &#x27;Asher&#x27;, &#x27;Olivia&#x27;, &#x27;Atticus&#x27;, &#x27;Amelia&#x27;, &#x27;Jack&#x27;, &#x27;Charlotte&#x27;, &#x27;Theodore&#x27;, &#x27;Isla&#x27;, &#x27;Oliver&#x27;,
  &#x27;Isabella&#x27;, &#x27;Jasper&#x27;, &#x27;Cora&#x27;, &#x27;Levi&#x27;, &#x27;Violet&#x27;, &#x27;Arthur&#x27;, &#x27;Mia&#x27;, &#x27;Thomas&#x27;, &#x27;Elizabeth&#x27;
];

@Component({
  selector: &#x27;app-quiz-detail&#x27;,
  templateUrl: &#x27;./quiz-detail.component.html&#x27;,
  styleUrls: [&#x27;./quiz-detail.component.scss&#x27;]
})
export class QuizDetailComponent implements OnInit {
  displayedColumns: string[] &#x3D; [&#x27;id&#x27;, &#x27;name&#x27;, &#x27;progress&#x27;, &#x27;color&#x27;];
  dataSource: MatTableDataSource&lt;UserData&gt;;

  @ViewChild(MatPaginator, {static: true}) paginator: MatPaginator;
  @ViewChild(MatSort, {static: true}) sort: MatSort;

  quiz: any &#x3D; [];
  start: boolean &#x3D; false;
  user: User;
  onlineUsers: [];
  ioConnection: any;
  quizResults: any &#x3D; [];
  resultsTable: any &#x3D; [];
  //chart data
  numToChar &#x3D; [&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;];
  chart: any &#x3D; [];
  canvasId: any;
  type: any;
  labels: any &#x3D; [];
  label: any;
  datasets: any &#x3D; {&#x27;label&#x27;: &#x27;&#x27;, &#x27;data&#x27;: [], &#x27;backgroundColor&#x27;: [], &#x27;correctAnswer&#x27;: []};
  data: any &#x3D; {&#x27;labels&#x27;: [],&#x27;datasets&#x27;: [this.datasets], &#x27;type&#x27;: &#x27;&#x27;};
  backgroundColor: any &#x3D; [
      &#x27;rgba(255, 99, 132, 0.8)&#x27;,
      &#x27;rgba(54, 162, 235, 0.8)&#x27;,
      &#x27;rgba(255, 206, 86, 0.8)&#x27;,
      &#x27;rgba(75, 192, 192, 0.8)&#x27;,
      &#x27;rgba(153, 102, 255, 0.8)&#x27;,
      &#x27;rgba(255, 159, 64, 0.8)&#x27;
  ];
  borderColor: any &#x3D; [
      &#x27;rgba(255,99,132,1)&#x27;,
      &#x27;rgba(54, 162, 235, 1)&#x27;,
      &#x27;rgba(255, 206, 86, 1)&#x27;,
      &#x27;rgba(75, 192, 192, 1)&#x27;,
      &#x27;rgba(153, 102, 255, 1)&#x27;,
      &#x27;rgba(255, 159, 64, 1)&#x27;
  ];
  
  constructor(private route: ActivatedRoute, private authService: AuthService, private api: QuizService, private chatService: ChatService, private router: Router) { 

  }

  ngOnInit() {
    
    this.authService.getLoginUser()
      .subscribe(res &#x3D;&gt; {
        //console.log(res);
        this.user &#x3D; {
        //id: randomId,
        userId: res.user.id,
        name: res.user.name,
        email: res.user.email
      };
      }, err &#x3D;&gt; {
        console.log(err);
      });
    this.getQuizDetails(this.route.snapshot.params[&#x27;id&#x27;]);
    this.getLastActiveUserByCourseId(this.quiz.courseId);

    if (this.authService.isLoggedIn() &amp;&amp; this.authService.isAdmin()) {
      this.initIoConnection();
    }

  }
  private initIoConnection(): void {
     
    this.ioConnection &#x3D; this.chatService.onQuizSubmit()
      .subscribe((quizResult: QuizResultModel) &#x3D;&gt; {
        console.log(&#x27;quizResult&#x27;, quizResult);
        //console.log(&#x27;this.user&#x27;,this.user);
        // exclude sender from game
        if (quizResult.from.userId !&#x3D; this.user.userId) {
          this.quizResults.push(quizResult);
          this.resultsTable.push(createNewUser(quizResult));
        }
    
        this.dataSource &#x3D; new MatTableDataSource(this.resultsTable);
        this.dataSource.paginator &#x3D; this.paginator;
        this.dataSource.sort &#x3D; this.sort;

        console.log(&#x27;quizResults&#x27;, this.quizResults);
        this.prepareChart(this.quizResults);
        
      });
      
  }
  public prepareChart(quizResults) {
    let labelsChart &#x3D; [];
    let dataChart &#x3D; [];
    let qOption &#x3D; [];
    quizResults.forEach((items, indexes) &#x3D;&gt; {

      items.questions.forEach((question, qi) &#x3D;&gt; {
          if (typeof dataChart[qi] &#x3D;&#x3D;&#x3D; &#x27;undefined&#x27;) {
          labelsChart[qi] &#x3D; [];
          dataChart[qi] &#x3D; [];
          qOption[qi] &#x3D; [];
          }
          question.options.forEach((item, index) &#x3D;&gt; {

          labelsChart[qi][index] &#x3D; this.numToChar[index];
          qOption[qi][index] &#x3D; item.name;
          // Index of correct Answer
          if(item.isAnswer){
              labelsChart[qi][index] &#x3D; [this.numToChar[index], &#x27;Correct&#x27;];
          }

          if (dataChart[qi][index] &#x3D;&#x3D; null){
              dataChart[qi][index] &#x3D; 0;
          }

          if(item.selected){
              dataChart[qi][index] +&#x3D; 1;
          }
          });

          this.getChart(question.id, &#x27;bar&#x27;, labelsChart[qi], question.name, dataChart[qi], qOption[qi], this.quizResults.length);

      });
      //console.log(&#x27;Question Option&#x27;, qOption);

      //console.log(&#x27;i &#x3D; &#x27;, dataChart)
    })
  }
  public getChart(canvasId, type, labels, label, data, qOption, numOfStudent) {
    //console.log(labels);
    this.chart &#x3D; new Chart(canvasId, {
        type: type,
        data: {
            labels: labels,
            qOption: qOption,
            datasets: [{
                label: label,
                data: data,
                backgroundColor: [
                    &#x27;rgba(255, 99, 132, 0.8)&#x27;,
                    &#x27;rgba(54, 162, 235, 0.8)&#x27;,
                    &#x27;rgba(255, 206, 86, 0.8)&#x27;,
                    &#x27;rgba(75, 192, 192, 0.8)&#x27;,
                    &#x27;rgba(153, 102, 255, 0.8)&#x27;,
                    &#x27;rgba(255, 159, 64, 0.8)&#x27;
                ],
                borderColor: [
                    &#x27;rgba(255,99,132,1)&#x27;,
                    &#x27;rgba(54, 162, 235, 1)&#x27;,
                    &#x27;rgba(255, 206, 86, 1)&#x27;,
                    &#x27;rgba(75, 192, 192, 1)&#x27;,
                    &#x27;rgba(153, 102, 255, 1)&#x27;,
                    &#x27;rgba(255, 159, 64, 1)&#x27;
                ],
                borderWidth: 1
            }]
        },
        options: {
          responsive: true,
          legend: {
            position: &#x27;top&#x27;,
          },
          scales: {
            
            yAxes: [{
              scaleLabel: {
                display: true,
                labelString: &#x27;Participant: &#x27;+ numOfStudent
              },
              ticks: {
                  //min: 0,
                  beginAtZero:true,
                  // forces step size to be 5 units
                  //stepSize: 2
              }
            }]
          },
          tooltips: {
          mode: &#x27;index&#x27;,
          callbacks: {
            // Use the footer callback to display the sum of the items showing in the tooltip
            title: function(tooltipItem, data) {
              
                var label &#x3D; data.qOption[tooltipItem[0].index] || &#x27;&#x27;;
                return label
            }
          },
          footerFontStyle: &#x27;normal&#x27;
        },
        }
    });
    
  }
  public getLastActiveUserByCourseId(courseId) {
    this.authService.getLastActiveUserByCourseId(courseId)
    .subscribe(res &#x3D;&gt; {
      //console.log(&#x27;last_active within 3 minute&#x27;, res.last_active);
      this.onlineUsers &#x3D; res.last_active;
    }, err &#x3D;&gt; {
      console.log(err);
    });
  }
  getQuizDetails(id) {
    this.api.getQuiz(id)
      .subscribe(data &#x3D;&gt; {
        console.log(data);
        this.quiz &#x3D; data;
        //console.log(&#x27;this.quiz&#x27;,this.quiz);
      });

  }
  /**
   * [startQuiz description]
   * @param {string}  quizId [description]
   * @param {boolean} start  [description]
   */
  public startQuiz(courseId: number, quizId: string, start: boolean): void {
    //console.log(courseId);
      if (!quizId) {
        return;
      }
      this.start &#x3D; start;
      this.chatService.startQuiz({
        id: quizId,
        courseId: courseId,
        from: this.user,
        start: this.start,
        duration: this.quiz.duration,
        created_at: new Date(),
      });
      console.log(&#x27;this.quiz.duration&#x27;, this.quiz.duration)
      setTimeout(()&#x3D;&gt; {
        //this.mode &#x3D; &#x27;result&#x27;;
        this.start &#x3D; false;
        //this.router.navigate([&quot;/quiz&quot;]);
      }, this.quiz.duration * 1000);

      this.api.updateQuiz(quizId, {last_played: new Date()})
      .subscribe(res &#x3D;&gt; {
        if (!res.errors) {
          let id &#x3D; res[&#x27;_id&#x27;];
          this.quiz.last_played &#x3D; new Date();
          console.log(&#x27;id&#x27;, id);
        }
        }, (err) &#x3D;&gt; {
          console.log(err);
        }
      );
  }

  deleteQuiz(id) {
    this.api.deleteQuiz(id)
      .subscribe(res &#x3D;&gt; {
          this.router.navigate([&#x27;/quizs&#x27;]);
        }, (err) &#x3D;&gt; {
          console.log(err);
        }
      );
  }
  applyFilter(filterValue: string) {
    this.dataSource.filter &#x3D; filterValue.trim().toLowerCase();

    if (this.dataSource.paginator) {
      this.dataSource.paginator.firstPage();
    }
  }

}

/** Builds and returns a new User. */
function createNewUser(quizResult): UserData {

  return {
    id: quizResult.id.toString(),
    name: quizResult.from.name,
    progress: quizResult.correctAnswerCount,
    color: quizResult.created_at
  };
}</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'UserData-2.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
